<!DOCTYPE html>
<html>
<head>
    <title>SIR Model Fitter</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 900px; margin: auto; }
        form { margin-bottom: 2em; }
        #plot-img { max-width: 100%; border: 1px solid #ccc; }
        #loading { display: none; font-weight: bold; }
        .error { color: red; border: 1px solid red; padding: 10px; }
        #results-text { background: #f4f4f4; padding: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>SIR Model Fitter</h1>
        <p>This tool fits the SIR model to real-world pandemic data to find the most likely transmission (β) and recovery (γ) rates.</p>
        
        <form id="sir-form">
            <label for="country">Country Name (e.g., USA, India, Italy):</label><br>
            <input type="text" id="country" name="country" value="USA" required>
            <input type="submit" value="Fit Model to Real Data">
        </form>
        
        <div id="loading">Fetching data and running simulations...</div>
        <div id="results"></div>
    </div>

    <script>
        const form = document.getElementById('sir-form');
        const loadingDiv = document.getElementById('loading');
        const resultsDiv = document.getElementById('results');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';
            
            const country = document.getElementById('country').value;
            
            try {
                // This path '/fit' is defined in our combined app.py
                const response = await fetch(`/fit?country=${country}`);
                const data = await response.json();
                
                loadingDiv.style.display = 'none';
                if (data.error) {
                    showError(data.error);
                } else if (data.img_data) {
                    resultsDiv.innerHTML = `
                        <h2>Results for ${country}</h2>
                        <div id="results-text">
                            <p><strong>Fitted Transmission Rate (β):</strong> ${data.beta.toFixed(4)}</p>
                            <p><strong>Fitted Recovery Rate (γ):</strong> ${data.gamma.toFixed(4)}</p>
                            <p><strong>Estimated R₀ (β/γ):</strong> ${(data.beta / data.gamma).toFixed(2)}</p>
                        </div>
                        <img src="data:image/png;base64,${data.img_data}" 
                             alt="SIR Plot" id="plot-img">
                    `;
                }
            } catch (err) {
                loadingDiv.style.display = 'none';
                showError(`Network Error: ${err.message}`);
            }
        });
        
        function showError(message) {
            resultsDiv.innerHTML = `<div class="error"><strong>Error:</strong> ${message}</div>`;
        }
    </script>
</body>
</html>
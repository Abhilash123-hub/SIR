<!DOCTYPE html>
<html>
<head>
    <title>Dynamic SIR Model Fitter</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 900px; margin: auto; }
        form { margin-bottom: 2em; }
        #plot-img { max-width: 100%; border: 1px solid #ccc; }
        #loading { display: none; font-weight: bold; }
        .error { color: red; border: 1px solid red; padding: 10px; }
        #results-text { background: #f4f4f4; padding: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dynamic SIR Model Fitter</h1>
        <p>This tool fits the SIR model to real-world data to find transmission (β) and recovery (γ) rates. It can find two different transmission rates (before and after an "intervention").</p>
        
        <form id="sir-form">
            <label for="country">Country Name (e.g., USA, India):</label><br>
            <input type="text" id="country" name="country" value="USA" required>
            <br><br>
            
            <label for="intervention_day">Intervention Day (e.g., 30):</label><br>
            <input type="number" id="intervention_day" name="intervention_day" value="30" required>
            <small>The day (out of 90) when you want to split Beta (β).</small>
            <br><br>

            <input type="submit" value="Fit Model to Real Data">
        </form>
        
        <div id="loading">Fetching data and running simulations...</div>
        <div id="results"></div>
    </div>

    <script>
        const form = document.getElementById('sir-form');
        const loadingDiv = document.getElementById('loading');
        const resultsDiv = document.getElementById('results');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';
            
            const country = document.getElementById('country').value;
            // --- NEW ---
            const interventionDay = document.getElementById('intervention_day').value;
            
            try {
                // --- UPDATED URL ---
                const response = await fetch(`/fit?country=${country}&intervention=${interventionDay}`);
                const data = await response.json();
                
                loadingDiv.style.display = 'none';
                if (data.error) {
                    showError(data.error);
                } else if (data.img_data) {
                    // --- UPDATED RESULTS ---
                    resultsDiv.innerHTML = `
                        <h2>Results for ${country}</h2>
                        <div id="results-text">
                            <p><strong>Fitted Beta 1 (β₁) (Before Day ${interventionDay}):</strong> ${data.beta1.toFixed(4)}</p>
                            <p><strong>Fitted Beta 2 (β₂) (After Day ${interventionDay}):</strong> ${data.beta2.toFixed(4)}</p>
                            <p><strong>Fitted Recovery Rate (γ):</strong> ${data.gamma.toFixed(4)}</p>
                            <hr>
                            <p><strong>Estimated R₀ (Before):</strong> ${(data.beta1 / data.gamma).toFixed(2)}</p>
                            <p><strong>Estimated R₀ (After):</strong> ${(data.beta2 / data.gamma).toFixed(2)}</p>
                        </div>
                        <img src="data:image/png;base64,${data.img_data}" 
                             alt="SIR Plot" id="plot-img">
                    `;
                }
            } catch (err)
                loadingDiv.style.display = 'none';
                showError(`Network Error: ${err.message}`);
            }
        });
        
        function showError(message) {
            resultsDiv.innerHTML = `<div class="error"><strong>Error:</strong> ${message}</div>`;
        }
    </script>
</body>
</html>